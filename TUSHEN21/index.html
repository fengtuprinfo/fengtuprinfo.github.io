<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¡—ç¥æ°´é›»ç‹å­ 21é»æŒ‘æˆ°è³½ (å…¨è£ç½®çµ‚æ¥µç‰ˆ)</title>
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        body {
            font-family: 'Microsoft JhengHei', 'Helvetica Neue', Arial, sans-serif;
            background-color: #1a1a1a; 
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: white;
            background-image: radial-gradient(#333 15%, transparent 16%), radial-gradient(#333 15%, transparent 16%);
            background-size: 20px 20px;
            overscroll-behavior: none; /* é˜²æ­¢æ‰‹æ©Ÿä¸‹æ‹‰é‡æ•´ */
            -webkit-tap-highlight-color: transparent; /* ç§»é™¤é»æ“Šè—æ¡† */
        }

        /* --- ç‰Œæ¡Œè¨­è¨ˆ (RWDæ ¸å¿ƒ) --- */
        .game-table {
            background-color: #4a4a4a;
            border: 10px solid #e67e22; 
            border-radius: 20px;
            padding: 20px; 
            width: 95%; 
            max-width: 800px;
            box-shadow: 0 10px 40px rgba(230, 126, 34, 0.3);
            text-align: center;
            position: relative;
            box-sizing: border-box;
            transition: border-color 0.5s; /* é‚Šæ¡†é¡è‰²è®ŠåŒ–ç‰¹æ•ˆ */
        }

        /* --- æ¨™é¡Œå„ªåŒ–ï¼šå¼·åˆ¶åˆ†è¡Œ --- */
        h1 { 
            margin-top: 0; 
            color: #f39c12;
            text-shadow: 2px 2px 0px #000;
            font-size: 28px;
            letter-spacing: 1px;
            margin-bottom: 10px;
            line-height: 1.4;
        }
        
        /* åœ¨æ‰‹æ©Ÿä¸ŠæŠŠæ¨™é¡Œæ‹†æˆå…©è¡Œé¡¯ç¤º */
        .title-part {
            display: inline-block;
        }

        .hand-area {
            margin: 10px 0;
            min-height: 130px; 
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 10px;
            border: 1px solid #666;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
        }
        
        .cards-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap; 
            gap: 5px;
            margin-top: 8px;
            width: 100%;
        }

        /* --- å¡ç‰Œæ¨£å¼ --- */
        .card {
            width: 75px;
            height: 110px;
            background: white;
            border-radius: 8px;
            color: black;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 4px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.4);
            font-weight: bold;
            font-size: 18px;
            position: relative;
            transition: transform 0.2s;
            user-select: none;
        }
        
        .card.red { color: #c0392b; }
        .card.black { color: #2c3e50; }

        .suit-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 36px;
        }

        /* --- åˆ†æ•¸é¡¯ç¤º --- */
        .score-display {
            font-size: 16px;
            background: #e67e22;
            color: white;
            padding: 4px 12px;
            border-radius: 50px;
            margin-bottom: 2px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            font-weight: bold;
            white-space: nowrap; /* é˜²æ­¢åˆ†æ•¸æ›è¡Œ */
        }

        /* --- è¨Šæ¯å€ --- */
        #message-area {
            min-height: 50px; /* å¢åŠ é«˜åº¦å®¹ç´å¤šè¡Œæ–‡å­— */
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            margin: 10px 0;
            color: #f1c40f;
            text-shadow: 1px 1px 4px black;
            padding: 0 5px;
            line-height: 1.3; /* å¢åŠ è¡Œè· */
        }

        /* --- æŒ‰éˆ•å€ --- */
        .controls { 
            margin-top: 10px; 
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 25px;
            font-size: 18px;
            cursor: pointer;
            border: none;
            border-radius: 10px; /* åœ“è§’æ›´æ˜é¡¯ */
            font-weight: bold;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
            touch-action: manipulation;
            flex: 1;
            min-width: 110px; 
            max-width: 220px;
            /* è§£æ±º iPhone æŒ‰éˆ•æ¨£å¼å•é¡Œ */
            -webkit-appearance: none; 
        }
        
        button:active { transform: translateY(4px); box-shadow: none; }
        #btn-hit { background-color: #f39c12; color: #2c3e50; } 
        #btn-stand { background-color: #c0392b; color: white; } 
        #btn-new { background-color: #3498db; color: white; display: none; } 

        /* --- å¡—ç¥åœ–ç‰‡å€åŸŸ --- */
        #tushen-image-container {
            margin-bottom: 10px;
            height: 180px; 
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            z-index: 1; /* ç¢ºä¿åœ¨æœ€ä¸Šå±¤ */
        }

        #tushen-image {
            height: 100%;
            width: auto;
            max-width: 100%;
            object-fit: contain;
            border-radius: 10px;
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5));
            transition: all 0.3s ease; 
        }

        .tushen-label {
            position: absolute;
            bottom: -15px;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 16px;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            white-space: nowrap;
            border: 1px solid rgba(255,255,255,0.2);
            z-index: 10;
        }

        /* =========================================
           ğŸ“± æ‰‹æ©Ÿå°ˆç”¨ (iPhone SE 2 / Galaxy A53 ç­‰)
           å¯¬åº¦ < 600px
           ========================================= */
        @media (max-width: 600px) {
            .game-table {
                padding: 15px 8px; /* æ¸›å°‘å·¦å³å…§è· */
                width: 96%;
                border-width: 6px;
            }

            /* æ¨™é¡Œå¼·åˆ¶æ›è¡Œ */
            .title-part { display: block; }
            h1 { font-size: 24px; margin-bottom: 5px; }

            /* å¡ç‰Œå†ç¸®å°ä¸€é»ä»¥é©æ‡‰ iPhone SE */
            .card {
                width: 58px;
                height: 88px;
                font-size: 16px;
                padding: 3px;
            }
            .suit-center { font-size: 26px; }

            /* æŒ‰éˆ•è®Šå¤§ï¼Œå¥½æŒ‰ */
            button {
                padding: 15px 0;
                font-size: 20px;
                width: 48%; /* è®“å…©å€‹æŒ‰éˆ•ä¸¦æ’ä¸”å¡«æ»¿ */
                min-width: auto;
                margin-bottom: 5px;
            }
            
            #message-area { font-size: 18px; min-height: 45px; }
            #tushen-image-container { height: 140px; }
        }

        /* =========================================
           ğŸ“± å¹³æ¿å°ˆç”¨ (iPad 9 / Redmi Pad SE)
           å¯¬åº¦ 601px ~ 1024px
           ========================================= */
        @media (min-width: 601px) and (max-width: 1024px) {
            .game-table {
                width: 85%; /* å¹³æ¿ä¸éœ€è¦å¤ªå¯¬ */
                padding: 30px;
            }

            h1 { font-size: 32px; }

            /* ç¢ºä¿æŒ‰éˆ•å¤ å¤§ï¼Œæ‰‹æŒ‡å¥½é» */
            button {
                padding: 18px 40px;
                font-size: 22px;
            }

            .card {
                width: 85px; /* å¹³æ¿å¡ç‰Œå¤§ä¸€é» */
                height: 125px;
                font-size: 22px;
            }
            
            #tushen-image-container { height: 220px; }
        }

        /* =========================================
           ğŸ”„ æ‰‹æ©Ÿæ©«å‘æ¨¡å¼ (é«˜åº¦çŸ®)
           ========================================= */
        @media (max-height: 500px) and (orientation: landscape) {
            body { padding: 5px; align-items: flex-start; }
            h1 { display: none; } /* éš±è—æ¨™é¡Œ */
            
            .game-table { 
                display: grid;
                grid-template-columns: 1fr 1fr; /* å·¦å³åˆ†æ¬„ */
                grid-template-rows: auto auto;
                gap: 10px;
                padding: 10px;
            }

            /* å·¦é‚Šæ”¾åœ–èˆ‡æ§åˆ¶ */
            #left-panel { grid-column: 1; display: flex; flex-direction: column; justify-content: center; }
            /* å³é‚Šæ”¾ç‰Œå±€ */
            #right-panel { grid-column: 2; }

            #tushen-image-container { 
                height: 100px; 
                margin: 0;
            }
            .tushen-label { bottom: 0; font-size: 12px; padding: 2px 8px; }

            .hand-area { min-height: 90px; padding: 5px; margin: 5px 0; }
            .card { width: 45px; height: 70px; font-size: 14px; }
            .suit-center { font-size: 20px; }
            
            #message-area { font-size: 16px; min-height: 25px; margin: 5px 0; }
            
            button { padding: 8px 15px; font-size: 16px; }
        }

        /* éš±è—çš„é è¼‰å®¹å™¨ */
        #preload-area { display: none; width: 0; height: 0; overflow: hidden; }
    </style>
</head>
<body>

<div id="preload-area"></div>

<div class="game-table" id="table-border">
    <h1>
        <span class="title-part">ğŸ› ï¸ å¡—ç¥æ°´é›»ç‹å­</span>
        <span class="title-part">21é»æŒ‘æˆ°è³½ ğŸš°</span>
    </h1>

    <div id="left-panel">
        <div id="tushen-image-container">
            <img id="tushen-image" src="TUSHENDRAW.png" alt="å¡—ç¥æ°´é›»ç‹å­">
            <div id="tushen-label" class="tushen-label"></div>
        </div>
        
        </div>

    <div id="right-panel">
        <div class="hand-area" style="background: rgba(230, 126, 34, 0.1);">
            <div class="score-display">
                <span class="icon">ğŸ‘·</span>å¡—ç¥: <span id="dealer-score">0</span>
            </div>
            <div class="cards-container" id="dealer-cards"></div>
        </div>

        <div class="hand-area">
            <div class="score-display">
                <span class="icon">ğŸ‘¤</span>ä½ : <span id="player-score">0</span>
            </div>
            <div class="cards-container" id="player-cards"></div>
        </div>
    </div>

    <div id="message-area">æº–å‚™å¥½æŒ‘æˆ°äº†å—ï¼Ÿ<br>æŒ‰ç™¼ç‰Œé–‹å§‹ï¼</div>

    <div class="controls">
        <button id="btn-new" onclick="startGame()" style="display:inline-block;">ç™¼ç‰Œ</button>
        <button id="btn-hit" onclick="hit()" style="display:none;">è¦ç‰Œ</button>
        <button id="btn-stand" onclick="stand()" style="display:none;">åœç‰Œ</button>
    </div>
</div>

<script>
    // éŠæˆ²è®Šæ•¸
    const suits = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
    const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
    let deck = [];
    let playerHand = [];
    let dealerHand = [];
    let gameOver = false;

    // åœ–ç‰‡è¨­å®š
    const tushenImages = {
        normal: { src: "TUSHENDRAW.png", label: "", color: "#e67e22" }, 
        win: { src: "TUSHENWIN.png", label: "å¡—ç¥ï¼šå“ˆå“ˆï¼æˆ‘è´å•¦ï¼ğŸ˜", color: "#e74c3c" }, 
        lose: { src: "TUSHENLOSE.png", label: "å¡—ç¥ï¼šå—šå—š...æ€éº¼è¼¸äº† ğŸ˜¢", color: "#2ecc71" }, 
        push: { src: "TUSHENDRAW.png", label: "å¹³æ‰‹ï¼å†ä¾†ä¸€æŠŠï¼ŸğŸ˜", color: "#95a5a6" } 
    };

    // --- é—œéµä¿®å¾©ï¼šåœ–ç‰‡é è¼‰åŠŸèƒ½ ---
    // æ‰‹æ©Ÿç‰ˆä¸æœƒè®Šåœ–é€šå¸¸æ˜¯å› ç‚ºåœ–ç‰‡é‚„æ²’è¼‰å…¥å®Œï¼Œé€™å€‹å‡½å¼æœƒå¼·åˆ¶ç€è¦½å™¨å…ˆè®€å–åœ–ç‰‡
    function preloadImages() {
        const preloadContainer = document.getElementById('preload-area');
        const imagesToLoad = [
            "TUSHENDRAW.png", 
            "TUSHENWIN.png", 
            "TUSHENLOSE.png"
        ];
        
        imagesToLoad.forEach(src => {
            const img = new Image();
            img.src = src;
            preloadContainer.appendChild(img);
        });
        console.log("åœ–ç‰‡é è¼‰å•Ÿå‹•...");
    }

    // é é¢è¼‰å…¥æ™‚åŸ·è¡Œé è¼‰
    window.onload = preloadImages;

    function createDeck() {
        deck = [];
        for (let suit of suits) {
            for (let value of values) {
                deck.push({ suit, value });
            }
        }
        for (let i = deck.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [deck[i], deck[j]] = [deck[j], deck[i]];
        }
    }

    function getCardValue(card) {
        if (['J', 'Q', 'K'].includes(card.value)) return 10;
        if (card.value === 'A') return 11;
        return parseInt(card.value);
    }

    function calculateScore(hand) {
        let score = 0;
        let aceCount = 0;
        for (let card of hand) {
            score += getCardValue(card);
            if (card.value === 'A') aceCount++;
        }
        while (score > 21 && aceCount > 0) {
            score -= 10;
            aceCount--;
        }
        return score;
    }

    function renderCard(card, container, hidden = false) {
        const cardDiv = document.createElement('div');
        cardDiv.className = `card ${['â™¥', 'â™¦'].includes(card.suit) ? 'red' : 'black'}`;
        
        if (hidden) {
            cardDiv.style.background = '#e67e22'; 
            cardDiv.style.backgroundImage = 'repeating-linear-gradient(45deg, transparent, transparent 5px, #d35400 5px, #d35400 10px)';
            cardDiv.style.border = '2px solid white';
        } else {
            cardDiv.innerHTML = `
                <div style="text-align:left; line-height: 1;">${card.value}</div>
                <div class="suit-center">${card.suit}</div>
                <div style="text-align:right; line-height: 1;">${card.value}</div>
            `;
        }
        container.appendChild(cardDiv);
    }

    function updateUI(showDealerHidden = false) {
        const dContainer = document.getElementById('dealer-cards');
        const pContainer = document.getElementById('player-cards');
        dContainer.innerHTML = '';
        pContainer.innerHTML = '';

        dealerHand.forEach((card, index) => {
            if (index === 0 && !showDealerHidden) {
                renderCard(card, dContainer, true);
            } else {
                renderCard(card, dContainer);
            }
        });

        playerHand.forEach(card => renderCard(card, pContainer));

        document.getElementById('player-score').innerText = calculateScore(playerHand);
        document.getElementById('dealer-score').innerText = showDealerHidden ? calculateScore(dealerHand) : "?";
    }

    // è¨Šæ¯å€æ”¯æ´ HTML æ¨™ç±¤ (ä¾‹å¦‚ <br>)
    function showMessage(msg, color = '#f1c40f') {
        const el = document.getElementById('message-area');
        el.innerHTML = msg; // æ”¹ç”¨ innerHTML æ”¯æ´æ›è¡Œ
        el.style.color = color;
    }

    function toggleButtons(playing) {
        document.getElementById('btn-new').style.display = playing ? 'none' : 'inline-block';
        document.getElementById('btn-hit').style.display = playing ? 'inline-block' : 'none';
        document.getElementById('btn-stand').style.display = playing ? 'inline-block' : 'none';
    }

    function updateTushenImage(state) {
        const img = document.getElementById('tushen-image');
        const label = document.getElementById('tushen-label');
        const tableBorder = document.getElementById('table-border'); // å–å¾—æ•´å€‹æ¡Œå­
        const data = tushenImages[state];
        
        // å¼·åˆ¶åˆ·æ–° src (è§£æ±ºéƒ¨åˆ†æ‰‹æ©Ÿç·©å­˜ä¸æ›´æ–°å•é¡Œ)
        // æ³¨æ„ï¼šå¦‚æœåœ–ç‰‡é–ƒçˆå¤ªåš´é‡ï¼Œå¯ä»¥æ‹¿æ‰ ?t=... éƒ¨åˆ†
        // ä½†ç‚ºäº†ç¢ºä¿æ‰‹æ©Ÿåˆ‡æ›ï¼Œç›´æ¥æŒ‡æ´¾ src é€šå¸¸å³å¯ï¼Œå› ç‚ºæˆ‘å€‘æœ‰ preload
        img.src = data.src;
        
        // æ”¹è®Šå¤–æ¡†é¡è‰²åŠ å¼·è¦–è¦ºæç¤º (å³ä½¿åœ–ç‰‡æ²’è·‘å‡ºä¾†ï¼Œæ¡†é¡è‰²è®Šäº†å°±çŸ¥é“è¼¸è´)
        tableBorder.style.borderColor = data.color; 
        
        if (state !== 'normal') {
            label.innerText = data.label;
            label.style.opacity = 1;
            // æ ¹æ“šè¼¸è´æ”¹è®Šæ¨™ç±¤èƒŒæ™¯è‰²
            if (state === 'lose') label.style.background = 'rgba(46, 204, 113, 0.9)'; 
            else if (state === 'win') label.style.background = 'rgba(231, 76, 60, 0.9)'; 
            else label.style.background = 'rgba(149, 165, 166, 0.9)'; 
        } else {
            label.style.opacity = 0;
        }
    }

    function startGame() {
        createDeck();
        playerHand = [deck.pop(), deck.pop()];
        dealerHand = [deck.pop(), deck.pop()];
        gameOver = false;
        
        updateUI(false);
        toggleButtons(true);
        showMessage("å¡—ç¥ï¼š<br>æ”¾é¦¬éä¾†å§ï¼"); // ä½¿ç”¨ <br> å¼·åˆ¶æ›è¡Œ
        updateTushenImage('normal'); 

        if (calculateScore(playerHand) === 21) {
            stand();
        }
    }

    function hit() {
        if (gameOver) return;
        playerHand.push(deck.pop());
        updateUI(false);

        if (calculateScore(playerHand) > 21) {
            endGame("çˆ†ç‰Œäº†ï¼<br>å¡—ç¥ç²å‹ï¼", '#e74c3c', 'win');
        }
    }

    function stand() {
        if (gameOver) return;
        while (calculateScore(dealerHand) < 17) {
            dealerHand.push(deck.pop());
        }
        updateUI(true);
        determineWinner();
    }

    function determineWinner() {
        const pScore = calculateScore(playerHand);
        const dScore = calculateScore(dealerHand);

        if (dScore > 21) {
            endGame("å¡—ç¥çˆ†ç‰Œäº†ï¼<br>æ‚¨è´äº†ï¼ ğŸ‰", '#2ecc71', 'lose');
        } else if (pScore > dScore) {
            endGame("æ­å–œï¼<br>æˆ°å‹äº†å¡—ç¥ï¼ ğŸ†", '#2ecc71', 'lose');
        } else if (pScore < dScore) {
            endGame("å¡—ç¥æŠ€é«˜ä¸€ç±Œï¼Œ<br>æ‚¨è¼¸äº†ã€‚ ğŸ”§", '#e74c3c', 'win');
        } else {
            endGame("å¹³å±€ (Push)ï¼<br>å†ä¾†ä¸€æŠŠï¼", 'white', 'push');
        }
    }

    function endGame(msg, color, imageState) {
        gameOver = true;
        showMessage(msg, color);
        toggleButtons(false);
        document.getElementById('btn-new').innerText = "å†æŒ‘æˆ°ä¸€æ¬¡";
        updateTushenImage(imageState); 
    }
</script>

</body>
</html>
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¡—ç¥æ°´é›»ç‹å­ - 21é»çµ‚æ¥µç‰ˆ</title>
    <style>
        /* --- 0. å…¨å±€è®Šæ•¸ & åŸºç¤é‡ç½® --- */
        :root {
            --primary: #f1c40f;   /* å¡—ç¥é‡‘ */
            --accent: #3498db;    /* ç©å®¶è— */
            --danger: #e74c3c;    /* è­¦å‘Šç´… */
            --success: #2ecc71;   /* å‹åˆ©ç¶  */
            --bg-dark: #121212;
            --panel-bg: rgba(30, 39, 46, 0.7);
            --glass-border: 1px solid rgba(255, 255, 255, 0.1);
            --radius: 16px;
        }

        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background: radial-gradient(circle at center, #2c3e50 0%, #000000 100%);
            margin: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden; /* ç¦æ­¢æ²å‹• */
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- 1. ä¸»å®¹å™¨ï¼šéŸ¿æ‡‰å¼ä½ˆå±€æ ¸å¿ƒ --- */
        .app-container {
            width: 100%;
            height: 100%;
            max-width: 1200px; /* é›»è…¦ç‰ˆé™åˆ¶æœ€å¤§å¯¬åº¦ */
            box-sizing: border-box;
            padding: 10px;
            display: flex;
            gap: 10px;
            transition: all 0.3s ease;
        }

        /* é è¨­ç›´ç«‹æ¨¡å¼ (Portrait): ä¸Šä¸‹æ’åˆ— */
        .app-container {
            flex-direction: column;
        }

        /* --- 2. éŠæˆ²å€åŸŸ (ç‰Œæ¡Œ) --- */
        .game-board {
            flex: 2; /* ä½”æ“šè¼ƒå¤šç©ºé–“ */
            background: var(--panel-bg);
            border: var(--glass-border);
            border-radius: var(--radius);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 10px;
            position: relative;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .hand-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            border-bottom: 1px dashed rgba(255,255,255,0.1);
        }
        .hand-section:last-child { border-bottom: none; }

        /* æ¨™ç±¤å¾½ç«  */
        .badge {
            position: absolute;
            top: 5px;
            left: 5px;
            background: var(--primary);
            color: #000;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
            z-index: 5;
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .badge.player { background: var(--accent); color: white; }
        .score-val { background: rgba(0,0,0,0.4); color: white; padding: 0 4px; border-radius: 3px; }

        /* å¡ç‰Œç¶²æ ¼ */
        .cards-area {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 5px;
            height: 100%;
            padding: 15px 0;
        }

        /* --- 3. æ§åˆ¶é¢æ¿ (å´é‚Šæ¬„/åº•éƒ¨æ¬„) --- */
        .sidebar {
            flex: 1;
            min-height: 200px; /* ç›´ç«‹æ¨¡å¼æœ€å°é«˜åº¦ */
            background: rgba(0, 0, 0, 0.4);
            border-radius: var(--radius);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 10px;
            border: var(--glass-border);
        }

        /* é ‚éƒ¨è³‡è¨Šå€ (æ¨™é¡Œ+é ­åƒ) */
        .info-group {
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        h1 { margin: 0; font-size: 20px; color: var(--primary); text-shadow: 0 2px 2px #000; }
        .sub-title { font-size: 10px; color: #ccc; letter-spacing: 2px; }

        .avatar-box {
            position: relative;
            width: 100%;
            height: 12vh; /* é«˜åº¦å‹•æ…‹ */
            min-height: 80px;
            max-height: 150px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 5px 0;
        }

        #tushen-img {
            height: 100%;
            width: auto;
            max-width: 100%;
            object-fit: contain;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.5));
            transition: transform 0.3s cubic-bezier(0.18, 0.89, 0.32, 1.28);
        }

        .speech-bubble {
            background: #fff;
            color: #000;
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
            position: absolute;
            bottom: 0;
            white-space: nowrap;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s;
            border: 2px solid var(--primary);
        }

        /* æ“ä½œå€ (è¨Šæ¯+æŒ‰éˆ•) */
        .controls-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        #msg-box {
            text-align: center;
            min-height: 24px;
            font-size: 14px;
            color: var(--primary);
            font-weight: bold;
            text-shadow: 0 1px 2px black;
        }

        .btn-row {
            display: flex;
            gap: 8px;
        }

        button {
            flex: 1;
            padding: 12px 0;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 rgba(0,0,0,0.3);
            color: white;
            transition: transform 0.1s;
        }
        button:active { transform: translateY(3px); box-shadow: none; }
        
        #btn-hit { background: linear-gradient(#f1c40f, #d35400); color: #2d3436; }
        #btn-stand { background: linear-gradient(#e74c3c, #c0392b); }
        #btn-deal { background: linear-gradient(#3498db, #2980b9); }

        /* èªè¨€åˆ‡æ› (çµ•å°å®šä½) */
        .lang-switch {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 100;
        }
        select { background: rgba(0,0,0,0.6); color: white; border: 1px solid #666; border-radius: 4px; padding: 2px; }


        /* --- 4. å¡ç‰Œæ¨£å¼ (æ¥µè‡´è‡ªé©æ‡‰) --- */
        .card {
            /* å¡ç‰Œé«˜åº¦ä¾è³´è¦–çª—é«˜åº¦ï¼Œç¢ºä¿æ°¸é ä¸æº¢å‡º */
            height: clamp(60px, 14vh, 140px);
            aspect-ratio: 2.5 / 3.5;
            background: white;
            border-radius: 6px;
            position: relative;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.4);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 3px;
            font-weight: bold;
            font-size: clamp(12px, 2vh, 20px);
            user-select: none;
            animation: dealCard 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28) forwards;
        }
        
        @keyframes dealCard {
            from { opacity: 0; transform: translateY(-30px) scale(0.5); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .card.red { color: #c0392b; }
        .card.black { color: #2c3e50; }
        .card.hidden {
            background: repeating-linear-gradient(45deg, #2c3e50, #2c3e50 5px, #34495e 5px, #34495e 10px);
            border: 2px solid #ecf0f1;
        }
        .suit-big { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 1.5em; }


        /* --- 5. æ©«å¼æ¨¡å¼ (Landscape) ç‰¹åˆ¥å„ªåŒ– --- */
        /* ç•¶å¯¬åº¦å¤§æ–¼é«˜åº¦æ™‚ï¼Œè½‰ç‚ºå·¦å³ä½ˆå±€ */
        @media (orientation: landscape) {
            .app-container {
                flex-direction: row; /* è®Šç‚ºå·¦å³æ’åˆ— */
                padding: 10px 20px; /* å¢åŠ å·¦å³ç•™ç™½é¿å… iPhone ç€æµ· */
            }

            .game-board {
                flex: 3; /* ç‰Œæ¡Œä½”å¯¬ä¸€é» */
                height: 100%;
            }

            .sidebar {
                flex: 1;
                min-height: auto;
                max-width: 280px; /* é™åˆ¶å´é‚Šæ¬„å¯¬åº¦ */
                height: 100%;
                justify-content: center; /* å…§å®¹å‚ç›´ç½®ä¸­ */
                gap: 20px;
            }
            
            .info-group { margin-bottom: auto; margin-top: 10px; }
            .controls-group { margin-top: auto; margin-bottom: 10px; }
            
            /* æ©«å¼æ™‚å¡ç‰Œå¯ä»¥å¤§ä¸€é» */
            .card {
                height: clamp(60px, 20vh, 160px);
            }
            
            .avatar-box { height: 18vh; }
            
            .btn-row { flex-direction: column; } /* æŒ‰éˆ•å‚ç›´æ’åˆ—å¥½æŒ‰ */
            button { padding: 15px 0; }
        }

        /* é‡å°æ¥µåº¦æ‰å¹³çš„æ‰‹æ©Ÿæ©«å± (å¦‚ iPhone SE æ©«æ”¾) çš„å¾®èª¿ */
        @media (orientation: landscape) and (max-height: 450px) {
            h1 { font-size: 16px; display: none; } /* ç©ºé–“ä¸å¤ æ™‚éš±è—æ¨™é¡Œ */
            .sub-title { display: none; }
            .avatar-box { height: 12vh; min-height: 50px; }
            .sidebar { justify-content: space-around; gap: 5px; }
            .game-board { padding: 5px; }
            .badge { font-size: 10px; top: 2px; left: 2px; }
            #msg-box { font-size: 12px; min-height: 18px; }
            button { padding: 8px 0; font-size: 14px; }
        }
    </style>
</head>
<body>

<div class="lang-switch">
    <select id="lang-select" onchange="changeLanguage()">
        <option value="zh-TW">ğŸ‡¹ğŸ‡¼ ç¹ä¸­</option>
        <option value="zh-CN">ğŸ‡¨ğŸ‡³ ç®€ä¸­</option>
        <option value="en">ğŸ‡ºğŸ‡¸ EN</option>
        <option value="ja">ğŸ‡¯ğŸ‡µ JP</option>
    </select>
</div>

<div class="app-container">
    <div class="game-board">
        <div class="hand-section" id="area-dealer">
            <div class="badge">
                <span data-i18n="dealer_name">å¡—ä¸‰å‚‘</span>
                <span class="score-val" id="score-dealer">0</span>
            </div>
            <div class="cards-area" id="cards-dealer"></div>
        </div>
        
        <div class="hand-section" id="area-player">
            <div class="badge player">
                <span data-i18n="player_name">ä½ </span>
                <span class="score-val" id="score-player">0</span>
            </div>
            <div class="cards-area" id="cards-player"></div>
        </div>
    </div>

    <div class="sidebar">
        <div class="info-group">
            <div>
                <h1><span data-i18n="title_main">å¡—ç¥æ°´é›»ç‹å­</span></h1>
                <div class="sub-title" data-i18n="title_sub">BLACKJACK</div>
            </div>
            <div class="avatar-box">
                <img id="tushen-img" src="TUSHENDRAW.png">
                <div id="tushen-msg" class="speech-bubble">Test</div>
            </div>
        </div>

        <div class="controls-group">
            <div id="msg-box" data-i18n="msg_welcome">æº–å‚™å¥½äº†å—ï¼Ÿ</div>
            
            <div class="btn-row">
                <button id="btn-hit" onclick="hit()" style="display:none;" data-i18n="btn_hit">è¦ç‰Œ</button>
                <button id="btn-stand" onclick="stand()" style="display:none;" data-i18n="btn_stand">åœç‰Œ</button>
                <button id="btn-deal" onclick="startGame()" data-i18n="btn_deal">ç™¼ç‰Œ</button>
            </div>
        </div>
    </div>
</div>

<div id="preload-area" style="display:none;"></div>

<script>
    /* --- éŠæˆ²é‚è¼¯èˆ‡å¤šåœ‹èªè¨€ --- */
    
    // 1. ç‹€æ…‹è®Šæ•¸
    const suits = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
    const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
    let deck = [], playerHand = [], dealerHand = [];
    let gameOver = true;
    let currentLang = 'zh-TW';

    // 2. åœ–ç‰‡è³‡æº
    const images = {
        normal: "TUSHENDRAW.png",
        win: "TUSHENWIN.png",
        lose: "TUSHENLOSE.png"
    };

    // 3. èªè¨€å­—å…¸
    const i18n = {
        'zh-TW': {
            title_main: 'å¡—ç¥æ°´é›»ç‹å­', title_sub: '21é»æŒ‘æˆ°è³½',
            dealer_name: 'å¡—ä¸‰å‚‘', player_name: 'ä½ ',
            btn_deal: 'ç™¼ç‰Œ', btn_hit: 'è¦ç‰Œ', btn_stand: 'åœç‰Œ',
            msg_welcome: 'æº–å‚™å¥½æŒ‘æˆ°äº†å—ï¼Ÿ',
            msg_start: 'æ”¾é¦¬éä¾†å§ï¼',
            msg_bust_p: 'çˆ†ç‰Œï¼å¡—ä¸‰å‚‘ç²å‹',
            msg_bust_d: 'èŠå®¶çˆ†ç‰Œï¼ä½ è´äº† ğŸ‰',
            msg_win: 'æ­å–œï¼ä½ è´äº† ğŸ†',
            msg_lose: 'å¡—ä¸‰å‚‘ç²å‹ ğŸ”§',
            msg_push: 'å¹³æ‰‹ï¼å†ä¾†ä¸€æŠŠ',
            talk_win: 'å“ˆå“ˆï¼æˆ‘è´å•¦ï¼', talk_lose: 'å—šå—š...è¼¸äº†', talk_push: 'å¹³æ‰‹...'
        },
        'zh-CN': {
            title_main: 'æ¶‚ç¥æ°´ç”µç‹å­', title_sub: '21ç‚¹æŒ‘æˆ˜èµ›',
            dealer_name: 'æ¶‚ä¸‰æ°', player_name: 'ä½ ',
            btn_deal: 'å‘ç‰Œ', btn_hit: 'è¦ç‰Œ', btn_stand: 'åœç‰Œ',
            msg_welcome: 'å‡†å¤‡å¥½æŒ‘æˆ˜äº†å—ï¼Ÿ',
            msg_start: 'æ”¾é©¬è¿‡æ¥å§ï¼',
            msg_bust_p: 'çˆ†ç‰Œï¼æ¶‚ä¸‰æ°è·èƒœ',
            msg_bust_d: 'åº„å®¶çˆ†ç‰Œï¼ä½ èµ¢äº† ğŸ‰',
            msg_win: 'æ­å–œï¼ä½ èµ¢äº† ğŸ†',
            msg_lose: 'æ¶‚ä¸‰æ°è·èƒœ ğŸ”§',
            msg_push: 'å¹³æ‰‹ï¼å†æ¥ä¸€æŠŠ',
            talk_win: 'å“ˆå“ˆï¼æˆ‘èµ¢å•¦ï¼', talk_lose: 'å‘œå‘œ...è¾“äº†', talk_push: 'å¹³æ‰‹...'
        },
        'en': {
            title_main: 'Plumber Prince', title_sub: 'BLACKJACK',
            dealer_name: 'Truman III', player_name: 'You',
            btn_deal: 'DEAL', btn_hit: 'HIT', btn_stand: 'STAND',
            msg_welcome: 'Ready to play?',
            msg_start: 'Bring it on!',
            msg_bust_p: 'Bust! Dealer wins.',
            msg_bust_d: 'Dealer Bust! You Win ğŸ‰',
            msg_win: 'You Win! ğŸ†',
            msg_lose: 'Dealer Wins. ğŸ”§',
            msg_push: 'Push! Play again.',
            talk_win: 'Haha! I Win!', talk_lose: 'Nooo... I lost.', talk_push: 'Draw.'
        },
        'ja': {
            title_main: 'é…ç®¡ç‹å­å¡—ç¥', title_sub: 'BJ ãƒãƒ£ãƒ¬ãƒ³ã‚¸',
            dealer_name: 'ç­’æ›¸ä¸‰éƒ', player_name: 'ã‚ãªãŸ',
            btn_deal: 'é…ã‚‹', btn_hit: 'ãƒ’ãƒƒãƒˆ', btn_stand: 'ã‚¹ã‚¿ãƒ³ãƒ‰',
            msg_welcome: 'æº–å‚™ã¯ã„ã„ï¼Ÿ',
            msg_start: 'ã‹ã‹ã£ã¦ã“ã„ï¼',
            msg_bust_p: 'ãƒã‚¹ãƒˆï¼ç­’æ›¸ã®å‹ã¡',
            msg_bust_d: 'ç­’æ›¸ãƒã‚¹ãƒˆï¼å›ã®å‹ã¡ ğŸ‰',
            msg_win: 'ãŠã‚ã§ã¨ã†ï¼å›ã®å‹ã¡ ğŸ†',
            msg_lose: 'ç­’æ›¸ã®å‹ã¡ã  ğŸ”§',
            msg_push: 'å¼•ãåˆ†ã‘ï¼',
            talk_win: 'ãƒãƒï¼åƒ•ã®å‹ã¡ã ï¼', talk_lose: 'è² ã‘ãŸ...', talk_push: 'å¼•ãåˆ†ã‘...'
        }
    };

    function t(key) { return i18n[currentLang][key] || key; }

    // --- æ ¸å¿ƒåŠŸèƒ½ ---
    function init() {
        // é åŠ è¼‰åœ–ç‰‡
        Object.values(images).forEach(src => {
            const img = new Image(); img.src = src;
            document.getElementById('preload-area').appendChild(img);
        });
        changeLanguage();
    }

    function changeLanguage() {
        currentLang = document.getElementById('lang-select').value;
        document.querySelectorAll('[data-i18n]').forEach(el => {
            el.innerText = t(el.getAttribute('data-i18n'));
        });
        updateControls();
    }

    function startGame() {
        gameOver = false;
        deck = createDeck();
        playerHand = [draw(), draw()];
        dealerHand = [draw(), draw()];
        
        renderGame(false);
        updateMsg('msg_start');
        setAvatar('normal');
        updateControls();

        if (getScore(playerHand) === 21) stand();
    }

    function hit() {
        if(gameOver) return;
        playerHand.push(draw());
        if (getScore(playerHand) > 21) {
            endGame('lose', 'msg_bust_p');
        } else {
            renderGame(false);
        }
    }

    function stand() {
        if(gameOver) return;
        while(getScore(dealerHand) < 17) dealerHand.push(draw());
        
        const pScore = getScore(playerHand);
        const dScore = getScore(dealerHand);
        
        if (dScore > 21) endGame('win', 'msg_bust_d');
        else if (pScore > dScore) endGame('win', 'msg_win');
        else if (pScore < dScore) endGame('lose', 'msg_lose');
        else endGame('push', 'msg_push');
    }

    function endGame(result, msgKey) {
        gameOver = true;
        renderGame(true); // ç¿»é–‹èŠå®¶ç‰Œ
        updateMsg(msgKey);
        updateControls();
        
        if (result === 'win') {
            setAvatar('lose', 'talk_lose'); // å¡—ç¥è¼¸äº†
            document.getElementById('msg-box').style.color = '#2ecc71';
        } else if (result === 'lose') {
            setAvatar('win', 'talk_win');   // å¡—ç¥è´äº†
            document.getElementById('msg-box').style.color = '#e74c3c';
        } else {
            setAvatar('normal', 'talk_push');
            document.getElementById('msg-box').style.color = 'white';
        }
    }

    // --- è¼”åŠ©å‡½å¼ ---
    function createDeck() {
        let d = [];
        suits.forEach(s => values.forEach(v => d.push({suit:s, val:v})));
        return d.sort(() => Math.random() - 0.5);
    }
    
    function draw() { return deck.pop(); }
    
    function getScore(hand) {
        let score = 0, aces = 0;
        hand.forEach(c => {
            if(['J','Q','K'].includes(c.val)) score += 10;
            else if(c.val === 'A') { score += 11; aces++; }
            else score += parseInt(c.val);
        });
        while(score > 21 && aces) { score -= 10; aces--; }
        return score;
    }

    function renderGame(showDealer) {
        renderHand('cards-dealer', dealerHand, showDealer);
        renderHand('cards-player', playerHand, true);
        
        document.getElementById('score-player').innerText = getScore(playerHand);
        document.getElementById('score-dealer').innerText = showDealer ? getScore(dealerHand) : '?';
    }

    function renderHand(id, hand, showAll) {
        const el = document.getElementById(id);
        el.innerHTML = '';
        hand.forEach((c, i) => {
            const div = document.createElement('div');
            const hidden = !showAll && i === 0;
            const isRed = ['â™¥','â™¦'].includes(c.suit);
            
            div.className = `card ${hidden ? 'hidden' : (isRed ? 'red' : 'black')}`;
            if (!hidden) {
                div.innerHTML = `
                    <div style="text-align:left;line-height:1">${c.val}</div>
                    <div class="suit-big">${c.suit}</div>
                    <div style="text-align:right;line-height:1">${c.val}</div>
                `;
            }
            el.appendChild(div);
        });
    }

    function updateControls() {
        const dealBtn = document.getElementById('btn-deal');
        const hitBtn = document.getElementById('btn-hit');
        const standBtn = document.getElementById('btn-stand');
        
        if (gameOver) {
            dealBtn.style.display = 'block';
            dealBtn.innerText = deck.length === 0 ? t('btn_deal') : t('btn_deal'); // å¯ä»¥æ”¹æˆ"å†ä¾†ä¸€å±€"
            hitBtn.style.display = 'none';
            standBtn.style.display = 'none';
        } else {
            dealBtn.style.display = 'none';
            hitBtn.style.display = 'block';
            standBtn.style.display = 'block';
        }
    }

    function updateMsg(key) {
        document.getElementById('msg-box').innerText = t(key);
        document.getElementById('msg-box').style.color = '#f1c40f'; // é‡ç½®é¡è‰²
    }

    function setAvatar(state, talkKey) {
        const img = document.getElementById('tushen-img');
        const bubble = document.getElementById('tushen-msg');
        
        img.src = images[state] || images.normal;
        
        if (talkKey) {
            bubble.innerText = t(talkKey);
            bubble.style.opacity = 1;
            bubble.style.transform = 'translateY(0)';
        } else {
            bubble.style.opacity = 0;
            bubble.style.transform = 'translateY(10px)';
        }
    }

    window.onload = init;
</script>

</body>
</html>
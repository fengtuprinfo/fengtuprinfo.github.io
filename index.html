<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¡—ç¥æ°´é›»ç‹å­ 21é»æŒ‘æˆ°è³½ (å…¨è£ç½®å„ªåŒ–ç‰ˆ)</title>
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        body {
            font-family: 'Microsoft JhengHei', 'Helvetica Neue', Arial, sans-serif;
            background-color: #1a1a1a; 
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: white;
            background-image: radial-gradient(#333 15%, transparent 16%), radial-gradient(#333 15%, transparent 16%);
            background-size: 20px 20px;
            /* é˜²æ­¢æ‰‹æ©Ÿä¸‹æ‹‰åˆ·æ–°å½±éŸ¿éŠæˆ²é«”é©— */
            overscroll-behavior: none;
        }

        /* --- ç‰Œæ¡Œè¨­è¨ˆ (RWDæ ¸å¿ƒ) --- */
        .game-table {
            background-color: #4a4a4a;
            border: 10px solid #e67e22; /* æ‰‹æ©Ÿç‰ˆé‚Šæ¡†ç¸®å°ä¸€é» */
            border-radius: 20px;
            padding: 20px; 
            
            /* é—œéµä¿®æ”¹ï¼šå¯¬åº¦é©æ‡‰ */
            width: 95%; 
            max-width: 800px;
            
            box-shadow: 0 10px 40px rgba(230, 126, 34, 0.3);
            text-align: center;
            position: relative;
            box-sizing: border-box; /* ç¢ºä¿paddingä¸æœƒæ’å¤§å¯¬åº¦ */
        }

        /* --- æ¨™é¡Œç‰¹æ•ˆ --- */
        h1 { 
            margin-top: 0; 
            color: #f39c12;
            text-shadow: 2px 2px 0px #000;
            /* è®“å­—é«”å¤§å°éš¨è¢å¹•ç¸®æ”¾ */
            font-size: clamp(24px, 5vw, 32px);
            letter-spacing: 2px;
            margin-bottom: 10px;
        }
        
        .hand-area {
            margin: 10px 0;
            min-height: 140px; /* ç¨å¾®ç¸®å°æœ€å°é«˜åº¦ */
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 10px;
            border: 1px solid #666;
            transition: all 0.3s;
        }
        
        .cards-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap; /* å…è¨±æ›è¡Œï¼Œé˜²æ­¢å¡ç‰Œéå¤šæº¢å‡º */
            gap: 5px;
            margin-top: 10px;
        }

        /* --- å¡ç‰Œæ¨£å¼ (é è¨­ PC/å¹³æ¿) --- */
        .card {
            width: 80px;
            height: 120px;
            background: white;
            border-radius: 8px;
            color: black;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 5px;
            box-shadow: 3px 3px 8px rgba(0,0,0,0.4);
            font-weight: bold;
            font-size: 20px;
            position: relative;
            transition: transform 0.2s;
            user-select: none; /* é˜²æ­¢é¸å–æ–‡å­— */
        }
        
        .card:hover { transform: translateY(-5px); }
        .card.red { color: #c0392b; }
        .card.black { color: #2c3e50; }

        .suit-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px;
        }

        /* --- åˆ†æ•¸é¡¯ç¤ºæ¿ --- */
        .score-display {
            font-size: 16px;
            background: #e67e22;
            color: white;
            display: inline-block;
            padding: 5px 15px;
            border-radius: 50px;
            margin-bottom: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            font-weight: bold;
        }

        /* --- æ§åˆ¶å€ --- */
        .controls { 
            margin-top: 15px; 
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap; /* æ‰‹æ©Ÿç‰ˆæŒ‰éˆ•æ›è¡Œ */
        }

        button {
            padding: 12px 30px;
            font-size: 18px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            transition: all 0.1s;
            font-weight: bold;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
            /* æ‰‹æ©Ÿç‰ˆå„ªåŒ–ï¼šé˜²æ­¢é›™æ“Šç¸®æ”¾ */
            touch-action: manipulation;
            flex: 1; /* è®“æŒ‰éˆ•å‡åˆ†å¯¬åº¦ */
            min-width: 120px;
            max-width: 200px;
        }
        
        button:active { transform: translateY(4px); box-shadow: none; }
        
        #btn-hit { background-color: #f39c12; color: #2c3e50; } 
        #btn-stand { background-color: #c0392b; color: white; } 
        #btn-new { background-color: #3498db; color: white; display: none; } 

        #message-area {
            min-height: 30px; /* æ”¹ç”¨ min-height é¿å…æ–‡å­—æ›è¡Œæ™‚è·³å‹• */
            font-size: clamp(16px, 4vw, 24px); /* å­—é«”éŸ¿æ‡‰å¼ */
            font-weight: bold;
            margin-top: 15px;
            color: #f1c40f;
            text-shadow: 1px 1px 4px black;
            padding: 0 10px;
        }

        /* --- å¡—ç¥åœ–ç‰‡å€åŸŸ --- */
        #tushen-image-container {
            margin-bottom: 10px;
            height: 200px; /* é è¨­é«˜åº¦ */
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        #tushen-image {
            max-height: 100%;
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            transition: all 0.5s ease; 
            border: 3px solid transparent;
        }

        .tushen-label {
            position: absolute;
            bottom: -10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: clamp(14px, 4vw, 20px);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
            white-space: nowrap;
            z-index: 10;
        }

        .icon { font-size: 20px; vertical-align: middle; margin-right: 5px; }

        /* =========================================
           ğŸ“± æ‰‹æ©Ÿç‰ˆå°ˆå±¬å„ªåŒ– (Media Queries) 
           ========================================= */
        
        /* è¢å¹•å¯¬åº¦å°æ–¼ 600px (å¤§å¤šæ•¸æ‰‹æ©Ÿç›´å‘) */
        @media (max-width: 600px) {
            .game-table {
                padding: 15px 10px;
                border-width: 8px;
                width: 98%;
            }

            /* ç¸®å°å¡ç‰Œå°ºå¯¸ */
            .card {
                width: 55px;
                height: 85px;
                font-size: 16px;
                padding: 3px;
            }

            .suit-center { font-size: 28px; }

            .hand-area {
                min-height: 110px;
                margin: 5px 0;
            }

            /* æŒ‰éˆ•è¨­ç‚ºå…¨å¯¬ï¼Œæ›´å¥½æŒ‰ */
            button {
                width: 100%;
                max-width: none;
                padding: 15px 0; /* å¢åŠ æ‰‹æŒ‡é»æ“Šç¯„åœ */
                font-size: 20px;
            }

            #tushen-image-container {
                height: 150px; /* ç¸®å°åœ–ç‰‡é«˜åº¦ */
            }
        }

        /* ğŸ“± æ‰‹æ©Ÿæ©«å‘æ¨¡å¼ (é«˜åº¦å¾ˆçŸ®çš„æ™‚å€™) */
        @media (max-height: 500px) and (orientation: landscape) {
            body { align-items: flex-start; padding-top: 10px; }
            
            /* éš±è—å¤§æ¨™é¡Œèˆ‡åœ–ç‰‡ï¼Œç¯€çœç©ºé–“ */
            h1 { display: none; }
            #tushen-image-container { 
                height: 80px; 
                position: absolute; /* å°‡é ­åƒç§»åˆ°è§’è½æˆ–ç¸®å° */
                top: 10px;
                right: 10px;
                margin: 0;
                width: 80px;
            }
            
            #tushen-image { height: 100%; width: 100%; object-fit: cover; }
            .tushen-label { bottom: -25px; font-size: 12px; }

            .game-table { padding-top: 10px; }
            
            /* èª¿æ•´æ‰‹ç‰Œå€åŸŸè®“æ©«å‘èƒ½ä¸¦æ’é¡¯ç¤º (å¦‚æœå¯¬åº¦å¤ ) */
            .hand-wrapper {
                display: flex;
                justify-content: space-around;
                width: 100%;
            }
            .hand-area {
                width: 48%;
                min-height: 120px;
            }
        }
    </style>
</head>
<body>

<div class="game-table">
    <h1>ğŸ› ï¸ å¡—ç¥æ°´é›»ç‹å­ 21é»å¤§è³½ ğŸš°</h1>

    <div id="tushen-image-container">
        <img id="tushen-image" src="TUSHENDRAW.png" alt="å¡—ç¥æ°´é›»ç‹å­">
        <div id="tushen-label" class="tushen-label"></div>
    </div>

    <div class="hand-wrapper">
        <div class="hand-area" style="background: rgba(230, 126, 34, 0.1);">
            <div class="score-display">
                <span class="icon">ğŸ‘·</span>å¡—ç¥: <span id="dealer-score">0</span>
            </div>
            <div class="cards-container" id="dealer-cards"></div>
        </div>

        <div class="hand-area">
            <div class="score-display">
                <span class="icon">ğŸ‘¤</span>ä½ : <span id="player-score">0</span>
            </div>
            <div class="cards-container" id="player-cards"></div>
        </div>
    </div>

    <div id="message-area">æº–å‚™å¥½æŒ‘æˆ°å¡—ç¥äº†å—ï¼ŸæŒ‰ç™¼ç‰Œé–‹å§‹ï¼</div>

    <div class="controls">
        <button id="btn-new" onclick="startGame()" style="display:inline-block;">ç™¼ç‰Œ</button>
        <button id="btn-hit" onclick="hit()" style="display:none;">è¦ç‰Œ</button>
        <button id="btn-stand" onclick="stand()" style="display:none;">åœç‰Œ</button>
    </div>
</div>

<script>
    // éŠæˆ²è®Šæ•¸
    const suits = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
    const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
    let deck = [];
    let playerHand = [];
    let dealerHand = [];
    let gameOver = false;

    // åœ–ç‰‡è³‡æ–™åº«
    const tushenImages = {
        normal: { src: "TUSHENDRAW.png", label: "", border: "transparent" }, 
        win: { src: "TUSHENWIN.png", label: "å¡—ç¥ï¼šå“ˆå“ˆï¼æˆ‘è´å•¦ï¼ğŸ˜", border: "#e74c3c" }, 
        lose: { src: "TUSHENLOSE.png", label: "å¡—ç¥è¼¸äº†...å—šå—šå—š ğŸ˜¢", border: "#2ecc71" }, 
        push: { src: "TUSHENDRAW.png", label: "å¹³æ‰‹ã€‚å†ä¾†ä¸€æŠŠï¼ŸğŸ˜", border: "#95a5a6" } 
    };

    // åˆå§‹åŒ–ç‰Œçµ„
    function createDeck() {
        deck = [];
        for (let suit of suits) {
            for (let value of values) {
                deck.push({ suit, value });
            }
        }
        for (let i = deck.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [deck[i], deck[j]] = [deck[j], deck[i]];
        }
    }

    // è¨ˆç®—å¡ç‰Œé»æ•¸
    function getCardValue(card) {
        if (['J', 'Q', 'K'].includes(card.value)) return 10;
        if (card.value === 'A') return 11;
        return parseInt(card.value);
    }

    // è¨ˆç®—æ‰‹ç‰Œç¸½åˆ†
    function calculateScore(hand) {
        let score = 0;
        let aceCount = 0;
        for (let card of hand) {
            score += getCardValue(card);
            if (card.value === 'A') aceCount++;
        }
        while (score > 21 && aceCount > 0) {
            score -= 10;
            aceCount--;
        }
        return score;
    }

    // æ¸²æŸ“å¡ç‰Œ
    function renderCard(card, container, hidden = false) {
        const cardDiv = document.createElement('div');
        cardDiv.className = `card ${['â™¥', 'â™¦'].includes(card.suit) ? 'red' : 'black'}`;
        
        if (hidden) {
            // ç‰ŒèƒŒè¨­è¨ˆ
            cardDiv.style.background = '#e67e22'; 
            cardDiv.style.backgroundImage = 'repeating-linear-gradient(45deg, transparent, transparent 10px, #d35400 10px, #d35400 20px)';
            cardDiv.style.border = '2px solid white';
        } else {
            cardDiv.innerHTML = `
                <div style="text-align:left; line-height: 1;">${card.value}</div>
                <div class="suit-center">${card.suit}</div>
                <div style="text-align:right; line-height: 1;">${card.value}</div>
            `;
        }
        container.appendChild(cardDiv);
    }

    // æ›´æ–°ä»‹é¢
    function updateUI(showDealerHidden = false) {
        const dContainer = document.getElementById('dealer-cards');
        const pContainer = document.getElementById('player-cards');
        dContainer.innerHTML = '';
        pContainer.innerHTML = '';

        dealerHand.forEach((card, index) => {
            if (index === 0 && !showDealerHidden) {
                renderCard(card, dContainer, true);
            } else {
                renderCard(card, dContainer);
            }
        });

        playerHand.forEach(card => renderCard(card, pContainer));

        document.getElementById('player-score').innerText = calculateScore(playerHand);
        document.getElementById('dealer-score').innerText = showDealerHidden ? calculateScore(dealerHand) : "?";
    }

    function showMessage(msg, color = '#f1c40f') {
        const el = document.getElementById('message-area');
        el.innerText = msg;
        el.style.color = color;
    }

    function toggleButtons(playing) {
        document.getElementById('btn-new').style.display = playing ? 'none' : 'inline-block';
        document.getElementById('btn-hit').style.display = playing ? 'inline-block' : 'none';
        document.getElementById('btn-stand').style.display = playing ? 'inline-block' : 'none';
    }

    function updateTushenImage(state) {
        const img = document.getElementById('tushen-image');
        const label = document.getElementById('tushen-label');
        const data = tushenImages[state];
        
        img.src = data.src;
        img.style.borderColor = data.border;
        
        if (state !== 'normal') {
            label.innerText = data.label;
            label.style.opacity = 1;
            if (state === 'lose') label.style.background = 'rgba(46, 204, 113, 0.9)'; 
            else if (state === 'win') label.style.background = 'rgba(231, 76, 60, 0.9)'; 
            else label.style.background = 'rgba(149, 165, 166, 0.9)'; 
        } else {
            label.style.opacity = 0;
        }
    }

    function startGame() {
        createDeck();
        playerHand = [deck.pop(), deck.pop()];
        dealerHand = [deck.pop(), deck.pop()];
        gameOver = false;
        
        updateUI(false);
        toggleButtons(true);
        showMessage("å¡—ç¥ï¼šæ”¾é¦¬éä¾†å§ï¼(è¦ç‰Œ/åœç‰Œ)");
        updateTushenImage('normal'); 

        if (calculateScore(playerHand) === 21) {
            stand();
        }
    }

    function hit() {
        if (gameOver) return;
        playerHand.push(deck.pop());
        updateUI(false);

        if (calculateScore(playerHand) > 21) {
            endGame("çˆ†ç‰Œäº†ï¼å¡—ç¥ç²å‹ï¼", '#e74c3c', 'win');
        }
    }

    function stand() {
        if (gameOver) return;
        while (calculateScore(dealerHand) < 17) {
            dealerHand.push(deck.pop());
        }
        updateUI(true);
        determineWinner();
    }

    function determineWinner() {
        const pScore = calculateScore(playerHand);
        const dScore = calculateScore(dealerHand);

        if (dScore > 21) {
            endGame("å¡—ç¥çˆ†ç‰Œäº†ï¼æ‚¨è´äº†ï¼ ğŸ‰", '#2ecc71', 'lose');
        } else if (pScore > dScore) {
            endGame("æ­å–œï¼æˆ°å‹äº†å¡—ç¥ï¼ ğŸ†", '#2ecc71', 'lose');
        } else if (pScore < dScore) {
            endGame("å¡—ç¥æŠ€é«˜ä¸€ç±Œï¼Œæ‚¨è¼¸äº†ã€‚ ğŸ”§", '#e74c3c', 'win');
        } else {
            endGame("å¹³å±€ (Push)ï¼å†ä¾†ä¸€æŠŠï¼", 'white', 'push');
        }
    }

    function endGame(msg, color, imageState) {
        gameOver = true;
        showMessage(msg, color);
        toggleButtons(false);
        document.getElementById('btn-new').innerText = "å†æŒ‘æˆ°ä¸€æ¬¡";
        updateTushenImage(imageState); 
    }
</script>

</body>
</html>